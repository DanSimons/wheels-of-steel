<html lang="en">
<head>
  <title>Bootstrap 5 Website Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <style>
  .fakeimg {
    height: 200px;
    background: #aaa;
  }
    body { margin: 0; padding: 0; }
    #map { position: relative; top: 0; bottom: 0; width: 100%; height: 600px;}
  </style>
</head>
<body>

    <div class="container mt-5">
        <div class="row">
            <div class="col-sm-8" id="map">
            </div>
        </div>
    </div>
    <a id="downloadLink" href="" download="map.png">Download â†“</a>
    

    <!-- <div class="mt-5 p-4 bg-dark text-white text-center">
        <p>Footer</p>
    </div> -->
    <script>
        // TO MAKE THE MAP APPEAR YOU MUST
        // ADD YOUR ACCESS TOKEN FROM
        // https://account.mapbox.com

        //routes_stops_xml = // something https://data.edmonton.ca/resource/4fvt-p2se.json?$query=SELECT%20%60route_id%60%2C%20%60stop_id%60

        mapboxgl.accessToken = 'pk.eyJ1IjoiZW1lcnlqNiIsImEiOiJjbHU0dGRkZzUxYWxwMm5wZHJ4em50M2czIn0.oLZ_d-htIuYQbIhVuiV_JA';
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            center: [-113.38763361949056, 53.57613482614986], // starting position [lng, lat]
            zoom: 9, // starting zoom
            style: 'mapbox://styles/mapbox/streets-v9',
            preserveDrawingBuffer: true
        });

        map.on('load', () => {
            map.addSource('wards', {
                type: 'geojson',
                // Use a URL for the value for the `data` property.
                data: 'backend/data_sets/Edmonton_wards.geojson'
                //data: 'https://data.edmonton.ca/resource/ctwr-tvrd.geojson?route_id=001'
                //data: 'backend/routes.geojson'
            });
            
            map.addSource('routes', {
                type: 'geojson',
                data: 'backend/data_sets/ETS_routes.geojson'
            });

            map.addSource('stops', {
                type: 'geojson',
                data: 'backend/data_sets/ETS_stops.geojson'
            });

            map.addLayer({
                'id': 'wards-layer',
                'type': 'fill',
                'source': 'wards',
                'paint': {
                    'fill-color': {
                        type: 'identity',
                        property: 'color',
                    },
                }
                //     //'fill-opacity': 0.4
                // }
            });

            map.addLayer({
                'id': 'wards-layer-outline',
                'type': 'line',
                'source': 'wards',
                'paint': {
                    'line-color': 'rgba(0, 0, 0, 1)',
                    'line-width': 2
                }
            });

            map.addLayer({
                'id': 'routes_layer',
                'type': 'line',
                'source': 'routes',
                'paint': {
                    'line-color': 'rgba(0, 0, 255, 1)',
                    'line-width': 1
                }
            });

            map.addLayer({
                'id': 'stops_layer',
                'type': 'circle',
                'source': 'stops',
                'paint': {
                    'circle-color': 'rgba(255, 0, 0, 1)'
                }
            });

            map.setFilter('wards-layer', ['==', ['get', 'name_2'], 'Anirniq Ward']);
            
            
            let layer_name = 'wards-layer';
            let property_name = 'name_2';
            let values = ['Anirniq Ward', 'Dene Ward'];
            map.setFilter(layer_name, ['match', ['get', property_name], values, true, false]);
            map.setFilter('wards-layer-outline', ['match', ['get', property_name], values, true, false]);
            // map.setFilter('wards-layer', ['==', ['get', 'route_id'], '004']);
            // map.setFilter('wards-layer', ['==', ['get', 'route_id'], '005']);
            // map.setFilter('wards-layer', ['==', ['get', 'route_id'], '006']);
            // const style = map.getStyle();
            // style.layers.find(({ id }) => id === "wards-layer").paint['fill-color']['type'] = 'identity';
            // style.layers.find(({ id }) => id === "wards-layer").paint['fill-color']['property'] = 'rgb(0, 255, 0)';
            // map.setStyle(style);
        });
        $('#downloadLink').click(function() {
        var img = map.getCanvas().toDataURL('image/png')
        this.href = img
        });

        
    </script>

</body>